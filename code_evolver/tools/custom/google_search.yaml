name: "Google Search"
type: "custom"
description: "Google Custom Search API integration for web searches. Responds to natural language queries like 'search for X', 'find out Y', 'top 10 Z results'. Includes RAG caching to store and reuse previous search results. Uses authentication from config.yaml."
cost_tier: "free"
speed_tier: "fast"
quality_tier: "excellent"
max_output_length: "long"
custom:
  module: "src.google_search_tool"
  class: "GoogleSearchTool"
  config:
    api_base: "https://www.googleapis.com/customsearch/v1"
    max_results: 10
    use_rag_cache: true
    rag_cache_ttl_hours: 24

input_schema:
  query:
    type: string
    description: "The search query"
    required: true
    example: "python machine learning tutorials"

  num_results:
    type: integer
    description: "Number of results to return (max 10 per request, max 100 total with pagination)"
    required: false
    default: 10

  start_index:
    type: integer
    description: "Starting index for pagination (1-based)"
    required: false
    default: 1

  safe_search:
    type: string
    description: "Safe search level"
    required: false
    default: "active"
    enum: ["active", "moderate", "off"]

  language:
    type: string
    description: "Interface language (e.g., 'en', 'es', 'fr')"
    required: false
    default: "en"

  country:
    type: string
    description: "Country code for geolocation (e.g., 'us', 'uk', 'ca')"
    required: false

  date_restrict:
    type: string
    description: "Restrict results to a time period (e.g., 'd[number]' for days, 'w[number]' for weeks, 'm[number]' for months, 'y[number]' for years)"
    required: false
    example: "m6"

  file_type:
    type: string
    description: "Restrict to specific file type (e.g., 'pdf', 'doc', 'ppt')"
    required: false

  site_search:
    type: string
    description: "Restrict search to specific site or domain (e.g., 'stackoverflow.com')"
    required: false

  exact_terms:
    type: string
    description: "Exact phrase that must appear in results"
    required: false

  exclude_terms:
    type: string
    description: "Terms to exclude from results"
    required: false

  use_cache:
    type: boolean
    description: "Use RAG cache for previously searched queries"
    required: false
    default: true

output_schema:
  type: object
  properties:
    success:
      type: boolean
      description: "Whether the operation succeeded"
    query:
      type: string
      description: "The search query that was executed"
    data:
      type: object
      description: "Search results"
      properties:
        items:
          type: array
          description: "Array of search result items"
        total_results:
          type: string
          description: "Total number of results available"
        search_time:
          type: number
          description: "Time taken for search (seconds)"
        cached:
          type: boolean
          description: "Whether results came from RAG cache"
    error:
      type: string
      description: "Error message if failed"

tags: ["google", "api", "search", "web", "research", "rag-cached", "knowledge"]

examples:
  - description: "Simple search"
    input:
      query: "python machine learning"
    output:
      success: true
      query: "python machine learning"
      data:
        items:
          - title: "Machine Learning in Python"
            link: "https://example.com/ml-python"
            snippet: "Learn machine learning with Python..."
            display_link: "example.com"
        total_results: "45600000"
        search_time: 0.23
        cached: false

  - description: "Search with filters and limits"
    input:
      query: "climate change research"
      num_results: 5
      date_restrict: "y1"
      site_search: "nature.com"
    output:
      success: true
      query: "climate change research"
      data:
        items:
          - title: "Recent Climate Change Studies"
            link: "https://nature.com/climate-research"
            snippet: "Latest findings on climate change..."
        total_results: "1250"
        search_time: 0.19

  - description: "Search for specific file types"
    input:
      query: "data science cheat sheet"
      file_type: "pdf"
      num_results: 10
    output:
      success: true
      query: "data science cheat sheet filetype:pdf"
      data:
        items:
          - title: "Data Science Cheat Sheet.pdf"
            link: "https://example.com/cheatsheet.pdf"

  - description: "Natural language - top 10 results"
    input:
      query: "find me the top 10 best practices for REST API design"
      num_results: 10
    output:
      success: true
      query: "best practices for REST API design"
      data:
        items:
          - title: "REST API Design Best Practices"

usage_notes: |
  ## Google Search Tool - Web Search with RAG Caching

  This tool provides integration with Google Custom Search API for web searches.
  It supports natural language queries, advanced search filters, and includes
  intelligent RAG caching to store and reuse previous search results.

  ## Features

  - [OK] Natural language query support
  - [OK] Advanced search filters (date, file type, site, etc.)
  - [OK] RAG caching for query results
  - [OK] Pagination support
  - [OK] Safe search filtering
  - [OK] Geolocation and language preferences
  - [OK] Authentication from config.yaml or environment
  - [OK] Automatic cache invalidation (TTL-based)

  ## Authentication Setup

  ### Step 1: Get Google API Key

  1. Go to [Google Cloud Console](https://console.cloud.google.com/)
  2. Create or select a project
  3. Enable "Custom Search API"
  4. Go to "Credentials" and create an API key

  ### Step 2: Create Custom Search Engine

  1. Go to [Google Programmable Search Engine](https://programmablesearchengine.google.com/)
  2. Click "Add" to create a new search engine
  3. Configure:
     - **Sites to search**: "Search the entire web"
     - **Name**: Your search engine name
  4. Copy the **Search Engine ID (CX)**

  ### Step 3: Configure Environment Variables

  ```bash
  export GOOGLE_API_KEY="your_api_key_here"
  export GOOGLE_SEARCH_ENGINE_ID="your_search_engine_id_here"
  ```

  Or use specific variables:

  ```bash
  export GOOGLE_SEARCH_API_KEY="your_api_key_here"
  export GOOGLE_SEARCH_ENGINE_ID="your_cx_id_here"
  ```

  ### Step 4: Update Config (Alternative)

  Add to your `config.yaml`:

  ```yaml
  google:
    api_key: "${GOOGLE_API_KEY}"
    search:
      api_key: "${GOOGLE_SEARCH_API_KEY}"
      search_engine_id: "${GOOGLE_SEARCH_ENGINE_ID}"
      enabled: true
      max_results: 10
      use_rag_cache: true
      rag_cache_ttl_hours: 24
  ```

  ## Usage Examples

  ### Example 1: Simple Search

  ```python
  from node_runtime import call_tool
  import json

  result = call_tool("google_search", json.dumps({
      "query": "python machine learning tutorials"
  }))

  data = json.loads(result)
  if data['success']:
      for item in data['data']['items']:
          print(f"Title: {item['title']}")
          print(f"URL: {item['link']}")
          print(f"Snippet: {item['snippet']}")
          print()
  ```

  ### Example 2: Natural Language Queries

  The tool recognizes natural language patterns:

  ```python
  # "Search for X" pattern
  result = call_tool("google_search", json.dumps({
      "query": "search for best python libraries 2024"
  }))

  # "Find out Y" pattern
  result = call_tool("google_search", json.dumps({
      "query": "find out how to deploy docker containers"
  }))

  # "Top N" pattern
  result = call_tool("google_search", json.dumps({
      "query": "top 10 javascript frameworks",
      "num_results": 10
  }))

  # General knowledge questions
  result = call_tool("google_search", json.dumps({
      "query": "what is quantum computing"
  }))
  ```

  ### Example 3: Advanced Filtering

  ```python
  # Search within specific timeframe
  result = call_tool("google_search", json.dumps({
      "query": "AI breakthroughs",
      "date_restrict": "m6",  # Last 6 months
      "num_results": 10
  }))

  # Search specific site
  result = call_tool("google_search", json.dumps({
      "query": "python tutorial",
      "site_search": "stackoverflow.com"
  }))

  # Search for specific file type
  result = call_tool("google_search", json.dumps({
      "query": "machine learning papers",
      "file_type": "pdf"
  }))

  # Combine filters
  result = call_tool("google_search", json.dumps({
      "query": "climate change",
      "date_restrict": "y1",  # Last year
      "site_search": "nature.com",
      "exact_terms": "peer reviewed"
  }))
  ```

  ### Example 4: Pagination

  ```python
  # Get first page (results 1-10)
  result = call_tool("google_search", json.dumps({
      "query": "python tutorials",
      "num_results": 10,
      "start_index": 1
  }))

  # Get second page (results 11-20)
  result = call_tool("google_search", json.dumps({
      "query": "python tutorials",
      "num_results": 10,
      "start_index": 11
  }))

  # Get third page (results 21-30)
  result = call_tool("google_search", json.dumps({
      "query": "python tutorials",
      "num_results": 10,
      "start_index": 21
  }))
  ```

  ### Example 5: RAG Cache Usage

  ```python
  # First search - hits API
  result1 = call_tool("google_search", json.dumps({
      "query": "python best practices",
      "use_cache": True
  }))
  print(f"Cached: {json.loads(result1)['data']['cached']}")  # False

  # Second search - from cache
  result2 = call_tool("google_search", json.dumps({
      "query": "python best practices",
      "use_cache": True
  }))
  print(f"Cached: {json.loads(result2)['data']['cached']}")  # True
  ```

  ### Example 6: Comprehensive Research Function

  ```python
  def research_topic(topic, max_results=10, include_pdfs=True):
      """Comprehensive research on a topic using Google Search."""
      results = []

      # General web search
      web_result = call_tool("google_search", json.dumps({
          "query": topic,
          "num_results": max_results,
          "date_restrict": "y1"  # Last year
      }))
      results.append(("Web Results", json.loads(web_result)))

      # Academic papers (PDFs)
      if include_pdfs:
          pdf_result = call_tool("google_search", json.dumps({
              "query": f"{topic} research paper",
              "file_type": "pdf",
              "num_results": 5
          }))
          results.append(("Academic Papers", json.loads(pdf_result)))

      # Stack Overflow discussions
      so_result = call_tool("google_search", json.dumps({
          "query": topic,
          "site_search": "stackoverflow.com",
          "num_results": 5
      }))
      results.append(("Developer Discussions", json.loads(so_result)))

      return results

  # Usage
  research = research_topic("microservices architecture")
  for category, data in research:
      print(f"\n{category}:")
      if data['success']:
          for item in data['data']['items']:
              print(f"  - {item['title']}: {item['link']}")
  ```

  ## Response Structure

  ### Successful Response

  ```json
  {
    "success": true,
    "query": "python machine learning",
    "processed_query": "python machine learning",
    "data": {
      "items": [
        {
          "title": "Machine Learning in Python",
          "link": "https://example.com/ml-python",
          "snippet": "Learn machine learning with Python...",
          "display_link": "example.com",
          "formatted_url": "https://example.com › ml-python",
          "html_snippet": "Learn <b>machine learning</b> with <b>Python</b>...",
          "mime": "text/html",
          "file_format": null
        }
      ],
      "total_results": "45600000",
      "search_time": 0.23,
      "cached": false,
      "cache_timestamp": null
    }
  }
  ```

  ### Error Response

  ```json
  {
    "success": false,
    "error": "API key not configured",
    "query": "some query"
  }
  ```

  ## Natural Language Patterns

  The tool automatically recognizes and processes these patterns:

  - **"search for [query]"** → Extracts "query"
  - **"find out [query]"** → Extracts "query"
  - **"look up [query]"** → Extracts "query"
  - **"google [query]"** → Extracts "query"
  - **"what is [query]"** → Searches "what is query"
  - **"how to [query]"** → Searches "how to query"
  - **"top N [query]"** → Sets num_results=N, extracts "query"

  ## RAG Caching System

  ### How It Works

  1. **First Search**: Query hits Google API, results stored in RAG
  2. **Subsequent Searches**: Identical queries return cached results
  3. **TTL Expiration**: Cache invalidates after configured hours (default: 24)
  4. **Storage**: Results stored as embeddings for semantic similarity matching

  ### Benefits

  - **Cost Savings**: Avoid duplicate API calls
  - **Speed**: Instant results from cache
  - **Consistency**: Same query returns same results within TTL
  - **Semantic Search**: Similar queries can reuse cached results

  ### Cache Control

  ```python
  # Disable cache for specific query (force fresh results)
  result = call_tool("google_search", json.dumps({
      "query": "breaking news today",
      "use_cache": False
  }))

  # Use cache (default)
  result = call_tool("google_search", json.dumps({
      "query": "python documentation",
      "use_cache": True
  }))
  ```

  ### Cache Storage

  Results are stored in the RAG memory system under:
  - **Artifact Type**: `search_result`
  - **Tool ID**: Tool identifier
  - **Metadata**: Query, timestamp, TTL, total_results
  - **Embedding**: Query text embedded for semantic matching

  ## API Limits

  - **Free tier**: 100 queries/day
  - **Paid tier**: Up to 10,000 queries/day
  - **Rate limit**: ~10 queries/second
  - **Max results per query**: 10
  - **Max total results**: 100 (via pagination)

  The tool automatically handles rate limiting and provides informative error messages.

  ## Date Restrict Values

  - `d[number]`: Days (e.g., `d7` = last 7 days)
  - `w[number]`: Weeks (e.g., `w2` = last 2 weeks)
  - `m[number]`: Months (e.g., `m6` = last 6 months)
  - `y[number]`: Years (e.g., `y1` = last year)

  ## Use Cases

  ### 1. Research and Information Gathering

  ```python
  # Gather information on a topic
  topics = ["quantum computing", "CRISPR technology", "renewable energy"]
  for topic in topics:
      result = call_tool("google_search", json.dumps({
          "query": topic,
          "num_results": 10,
          "date_restrict": "y1"
      }))
      # Process results...
  ```

  ### 2. Competitive Analysis

  ```python
  # Research competitors
  result = call_tool("google_search", json.dumps({
      "query": "best CRM software 2024",
      "num_results": 10
  }))
  ```

  ### 3. Technical Problem Solving

  ```python
  # Find solutions on Stack Overflow
  result = call_tool("google_search", json.dumps({
      "query": "python async await error handling",
      "site_search": "stackoverflow.com"
  }))
  ```

  ### 4. Academic Research

  ```python
  # Find research papers
  result = call_tool("google_search", json.dumps({
      "query": "machine learning healthcare applications",
      "file_type": "pdf",
      "date_restrict": "y2",
      "exact_terms": "peer reviewed"
  }))
  ```

  ### 5. News and Current Events

  ```python
  # Find recent news
  result = call_tool("google_search", json.dumps({
      "query": "AI regulations",
      "date_restrict": "w1",  # Last week
      "use_cache": False  # Don't cache news
  }))
  ```

  ## Best Practices

  1. **Use RAG cache for static content**: Documentation, tutorials, evergreen content
  2. **Disable cache for dynamic content**: News, real-time data, breaking information
  3. **Be specific with queries**: Better queries = better results
  4. **Use filters**: Date, site, file type filters improve result quality
  5. **Respect API limits**: Use cache to minimize API calls
  6. **Handle pagination**: For comprehensive research, paginate through results
  7. **Check cache status**: Know whether results are fresh or cached

  ## Troubleshooting

  ### No Results Found

  - Broaden your search query
  - Remove restrictive filters
  - Check spelling and phrasing
  - Try different keywords

  ### API Key Issues

  - Verify API key in environment or config
  - Ensure Custom Search API is enabled
  - Check API key restrictions
  - Verify Search Engine ID (CX) is correct

  ### Rate Limiting

  - Enable RAG caching to reduce API calls
  - Implement delays between searches
  - Monitor your daily quota
  - Consider upgrading to paid tier

  ### Cache Issues

  - Check RAG memory configuration
  - Verify Qdrant is running (if used)
  - Clear cache by setting `use_cache: false`
  - Check cache TTL settings

  ## Integration with Workflows

  ### Pattern: Multi-Source Research

  ```python
  def comprehensive_research(query):
      # Web search
      web = call_tool("google_search", json.dumps({"query": query}))

      # Academic search
      academic = call_tool("google_search", json.dumps({
          "query": f"{query} research",
          "file_type": "pdf"
      }))

      # Developer resources
      dev = call_tool("google_search", json.dumps({
          "query": query,
          "site_search": "github.com"
      }))

      # Combine and analyze results
      return combine_results(web, academic, dev)
  ```

  ### Pattern: Cached Knowledge Base

  ```python
  # Build a knowledge base with caching
  topics = ["AI", "ML", "NLP", "CV", "RL"]
  knowledge_base = {}

  for topic in topics:
      result = call_tool("google_search", json.dumps({
          "query": f"{topic} fundamentals",
          "use_cache": True  # Cache for reuse
      }))
      knowledge_base[topic] = json.loads(result)
  ```
