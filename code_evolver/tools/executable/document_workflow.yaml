name: "Document Workflow"
type: "executable"
description: "Generates comprehensive 'How to Use' documentation for a workflow and saves it to README.txt in the workflow directory. Analyzes the code, detects inputs/outputs, identifies tool calls, and creates detailed documentation with examples, flowcharts, and usage instructions."

executable:
  command: "python"
  args: ["tools/executable/document_workflow.py"]
  working_dir: "."
  timeout_ms: 300000  # 5 minutes (LLM call for documentation generation)
  requires_stdin: true

input_schema:
  workflow_path:
    type: string
    description: "Absolute or relative path to the workflow's main.py file"
    required: true
    example: "nodes/my_workflow/main.py"
  workflow_name:
    type: string
    description: "Optional: Name of the workflow. If not provided, will be derived from directory name."
    required: false
    example: "Email Validator"
  description:
    type: string
    description: "Optional: High-level description of what the workflow does. If not provided, will be extracted from code docstring."
    required: false
    example: "Validates email addresses and checks domain matching"

output_schema:
  type: object
  description: "Result of documentation generation"
  properties:
    success:
      type: boolean
      description: "Whether documentation was generated successfully"
    workflow_name:
      type: string
      description: "Name of the documented workflow"
    documentation_path:
      type: string
      description: "Path to the generated README.txt file"
    documentation_length:
      type: integer
      description: "Length of generated documentation in characters"
    preview:
      type: string
      description: "Preview of the first 500 characters of documentation"
    error:
      type: string
      description: "Error message if generation failed (only present on failure)"

tags: ["documentation", "workflow", "readme", "generator", "automation", "metadata"]
cost_tier: "medium"  # Uses LLM for documentation generation
speed_tier: "medium"  # Takes 1-3 minutes due to LLM call
quality_tier: "excellent"
priority: 70

examples:
  - inputs:
      workflow_path: "nodes/email_validator/main.py"
      workflow_name: "Email Validator"
      description: "Validates email addresses using regex"
    output: |
      {
        "success": true,
        "workflow_name": "Email Validator",
        "documentation_path": "nodes/email_validator/README.txt",
        "documentation_length": 3542,
        "preview": "## Overview\nValidates email addresses and optionally checks if they belong to a specific domain.\n\n## What It Does\nThis workflow checks if an email address is valid using regex pattern matching. If you provide a domain name, it will also check if the email address belongs to that domain.\n\n## Required Inputs\n\n- **email** (string, required)\n  - The email address to validate\n  - Example: `\"user@example.com\"`\n\n- **domain** (string, optional)\n  - The domain to check against (without @)..."
      }

  - inputs:
      workflow_path: "nodes/translate_article/main.py"
    output: |
      {
        "success": true,
        "workflow_name": "Translate Article",
        "documentation_path": "nodes/translate_article/README.txt",
        "documentation_length": 4821,
        "preview": "## Overview\nTranslates articles to your chosen language using neural machine translation.\n\n## What It Does\nThis workflow takes an article in any language and translates it to your target language using advanced AI translation. It works with most major languages and preserves the general structure of the text.\n\n## How It Works\n\n### Process Flow\n```mermaid\nflowchart TD\n    A[Start: Receive Input] --> B[Extract article and target language]\n    B --> C[Build translation prompt]..."
      }

usage_notes: |
  ## When to Use This Tool

  Use this tool after creating a workflow to automatically generate comprehensive documentation:

  1. **New Workflows**: Document immediately after creation
  2. **Updated Workflows**: Regenerate docs after significant changes
  3. **Batch Documentation**: Document all workflows in a directory
  4. **API Publishing**: Before exposing workflows via API
  5. **Front-End Generation**: Before auto-generating UI

  ## What Gets Generated

  The tool creates a README.txt file with:
  - Overview and purpose
  - Input/output specifications with examples
  - Mermaid flowcharts showing process flow
  - Sequence diagrams for tool interactions
  - Code examples (API, Python, curl)
  - Common use cases and scenarios
  - Error handling and troubleshooting
  - Limitations and constraints
  - FAQ section

  ## Input Detection

  The tool automatically detects:
  - Required input fields (via regex: `input_data.get("field")`)
  - Tool calls (via regex: `call_tool("tool_name")`)
  - Workflow complexity (based on tool usage)
  - Estimated speed (based on LLM calls vs pure Python)

  ## Example Usage

  ### Document a Single Workflow
  ```bash
  cd code_evolver
  echo '{"workflow_path": "nodes/my_workflow/main.py"}' | python tools/executable/document_workflow.py
  ```

  ### Document with Custom Name
  ```bash
  echo '{
    "workflow_path": "nodes/validator/main.py",
    "workflow_name": "Advanced Email Validator",
    "description": "Enterprise-grade email validation with domain checking"
  }' | python tools/executable/document_workflow.py
  ```

  ### Batch Document All Workflows
  ```python
  import json
  import subprocess
  from pathlib import Path

  workflows_dir = Path("nodes")
  for workflow_path in workflows_dir.glob("*/main.py"):
      input_data = {"workflow_path": str(workflow_path)}
      result = subprocess.run(
          ["python", "tools/executable/document_workflow.py"],
          input=json.dumps(input_data),
          capture_output=True,
          text=True
      )
      print(f"Documented: {workflow_path.parent.name}")
  ```

  ## Output Location

  Documentation is saved to `README.txt` in the same directory as the workflow's main.py file:

  ```
  nodes/
    my_workflow/
      main.py           # Your workflow code
      README.txt        # Generated documentation âœ“
  ```

  ## Requirements

  - Workflow must have a main.py file
  - System must have access to workflow_documenter LLM tool
  - LLM backend must be available (for documentation generation)

  ## Performance

  - **Speed**: 1-3 minutes per workflow (due to LLM call)
  - **Parallelization**: Can document multiple workflows in parallel
  - **Caching**: Documentation can be regenerated as needed
