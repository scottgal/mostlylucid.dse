# Library Restrictions Contract
# Defines allowed and forbidden libraries

contract_id: "library_restrictions"
name: "Library Usage Restrictions"
description: |
  Contract defining library usage restrictions:
  - Forbidden libraries (security, licensing, deprecation)
  - Required standard imports
  - Generic import placeholder for pip installs
version: "1.0.0"
tags:
  - security
  - libraries
  - dependencies
author: "Code Evolver System"
created_at: "2025-01-17"

rules:
  # Rule 1: Never use eval/exec
  - rule_id: "LIB-001"
    name: "No Eval or Exec"
    description: "Never use eval() or exec() for security reasons"
    rule_type: "pattern"
    severity: "error"
    pattern: '\b(eval|exec)\s*\('
    required: false  # Must NOT be present
    applies_to:
      - "module"

  # Rule 2: Forbidden libraries (example: pickle for security)
  - rule_id: "LIB-002"
    name: "No Pickle Import"
    description: "Avoid pickle module due to security risks (use json instead)"
    rule_type: "library"
    severity: "warning"
    pattern: "^pickle$"
    required: false  # Must NOT be present
    applies_to:
      - "module"

  # Rule 3: Deprecated libraries (example: optparse)
  - rule_id: "LIB-003"
    name: "No Deprecated Libraries"
    description: "Do not use deprecated libraries"
    rule_type: "library"
    severity: "warning"
    pattern: "^(optparse|imp)$"
    required: false  # Must NOT be present
    applies_to:
      - "module"

  # Rule 4: Generic import placeholder for pip installs
  - rule_id: "LIB-004"
    name: "Import Placeholder Pattern"
    description: |
      Use generic import placeholder pattern to make pip installs transparent:
      try:
          import package
      except ImportError:
          # AUTO-INSTALL: package
          import subprocess
          subprocess.check_call([sys.executable, "-m", "pip", "install", "package"])
          import package
    rule_type: "pattern"
    severity: "info"
    pattern: '# AUTO-INSTALL:'
    required: false  # Optional pattern
    applies_to:
      - "module"
