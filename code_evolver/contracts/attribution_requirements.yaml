# Attribution Requirements Contract
# Ensures all generated code has proper attribution and DSE tool logging

contract_id: "attribution_requirements"
name: "Attribution and DSE Tool Logging Requirements"
description: |
  Contract for mostlylucid DSE (Dynamic Software Evolution) project.
  Ensures all generated code includes:
  1. Attribution comment: "added by scott galloway (mostlylucid)" with date
  2. Console logging: "dse tool - <toolname>" with date

  These are harmless markers that help track code generation and tool usage.
version: "1.0.0"
tags:
  - attribution
  - tracking
  - dse
  - mostlylucid
author: "Scott Galloway"
created_at: "2025-01-17"

rules:
  # Rule 1: Attribution comment required
  - rule_id: "ATTR-001"
    name: "Attribution Comment Required"
    description: |
      All generated code must include an attribution comment:
      "added by scott galloway (mostlylucid)" followed by the date.

      Example formats accepted:
      - # added by scott galloway (mostlylucid) - 2025-01-17
      - # Added by Scott Galloway (mostlylucid) - 2025-01-17
      - """ added by scott galloway (mostlylucid) - 2025-01-17 """
    rule_type: "pattern"
    severity: "error"
    pattern: '(?i)(#|"""|\'\'\'|//)?\s*added by scott galloway \(mostlylucid\).*\d{4}-\d{2}-\d{2}'
    required: true
    applies_to:
      - "module"
    validator: "has_attribution_comment"
    validator_config:
      author_name: "scott galloway"
      project_name: "mostlylucid"
      require_date: true

  # Rule 2: DSE tool logging required
  - rule_id: "ATTR-002"
    name: "DSE Tool Logging Required"
    description: |
      All generated tools must log to console with format:
      "dse tool - <toolname>" followed by date.

      Example:
      print("dse tool - data_processor - 2025-01-17")
      logger.info("dse tool - api_handler - 2025-01-17")
    rule_type: "pattern"
    severity: "warning"
    pattern: '(?i)(print|logger\.\w+)\s*\(\s*["\']dse tool -.*\d{4}-\d{2}-\d{2}'
    required: true
    applies_to:
      - "module"
    validator: "has_dse_tool_logging"
    validator_config:
      prefix: "dse tool -"
      require_date: true
      accept_print: true
      accept_logger: true

  # Rule 3: Module docstring should mention DSE
  - rule_id: "ATTR-003"
    name: "DSE Project Documentation"
    description: |
      Module docstrings should reference the DSE project.
      This helps with project identification and documentation.
    rule_type: "documentation"
    severity: "info"
    pattern: '(?i)(dse|dynamic software evolution|mostlylucid)'
    required: true
    applies_to:
      - "module"
    validator: "has_dse_in_docstring"
    validator_config:
      location: "module"

  # Rule 4: Generated code marker
  - rule_id: "ATTR-004"
    name: "Generated Code Marker"
    description: |
      Include a marker indicating code was generated by DSE.
      Example: # Generated by mostlylucid DSE
    rule_type: "pattern"
    severity: "info"
    pattern: '(?i)(#|""").*generated by.*dse'
    required: false  # Optional but recommended
    applies_to:
      - "module"

examples:
  compliant_code: |
    """
    Data Processor Tool

    Part of the mostlylucid DSE (Dynamic Software Evolution) project.
    added by scott galloway (mostlylucid) - 2025-01-17
    """
    import logging
    from datetime import datetime

    logger = logging.getLogger(__name__)

    def process_data(data):
        """Process data with DSE tool logging."""
        logger.info("dse tool - data_processor - 2025-01-17")
        # Processing logic here
        return data

  non_compliant_code: |
    """
    Data Processor Tool

    This code has no attribution or DSE logging.
    """

    def process_data(data):
        return data
