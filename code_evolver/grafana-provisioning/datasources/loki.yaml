# ============================================================================
# Grafana Datasource Provisioning - Loki
# ============================================================================

apiVersion: 1

datasources:
  - name: Loki
    type: loki
    access: proxy
    url: http://loki:3100
    isDefault: true
    editable: true
    jsonData:
      maxLines: 1000
      derivedFields:
        # Extract workflow_id from logs
        - datasourceUid: loki
          matcherRegex: '"workflow_id":\s*"([^"]+)"'
          name: workflow_id
          url: ''

        # Extract exception_type from logs
        - datasourceUid: loki
          matcherRegex: '"exception_type":\s*"([^"]+)"'
          name: exception_type
          url: ''

        # Extract tool_name from logs
        - datasourceUid: loki
          matcherRegex: '"tool_name":\s*"([^"]+)"'
          name: tool_name
          url: ''
